# vim: expandtab:ts=8:sw=2:tw=80:fdm=marker:ft=yaml:
%YAML 1.1
---
# Keep the includes first to illustrate that definitions that everything that
# follows override included definitions.
include:
  # Use MergeRequest pipelines
  # https://docs.gitlab.com/ee/ci/yaml/#workflowrules-templates
  - template: 'Workflows/MergeRequest-Pipelines.gitlab-ci.yml'
  - project: ModioAB/CI
    ref: main
    file:
      - /ci/default.yml
      - /ci/container.yml

.matrix:
  parallel:
    matrix:
      - SUBDIR:
          - debian9
          - debian10

container:
  # We replace everything except the "rules" section here...
  extends:
    - .container:publish
    - .matrix
  tags:
    - arm
  variables:
    # Injecting these arguments to podman makes it work and resolve the armv7
    # containers properly.
    # Note, still needs qemu-user-static on the host
    PODMAN_PULL: "--pull=false --platform=linux/arm"
  script:
    - podman info
    - make -C ${SUBDIR} login
    - make -C ${SUBDIR} build-publish
...
